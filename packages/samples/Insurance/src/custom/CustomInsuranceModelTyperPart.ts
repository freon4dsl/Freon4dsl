// Generated by the Freon Language Generator.
import { FreNode, FreType, FreTyper, AstType, FreLanguage, notNullOrUndefined } from '@freon4dsl/core';
import { EuroType, MultiplyExpression, NumberType, ParameterRef, PercentageType } from "../freon/language/gen/index.js";

/**
 * Class 'CustomInsuranceModelTyperPart' is meant to be a convenient place to add any
 * custom code for type checking.
 */
export class CustomInsuranceModelTyperPart implements FreTyper {
    mainTyper!: FreTyper;
    static fromValidator: boolean = false;

    isType(modelelement: FreNode): boolean {
        return false;
    }

    inferType(modelelement: FreNode): FreType | undefined {
        let result: FreType | undefined = undefined;
        if (CustomInsuranceModelTyperPart.fromValidator) {
            if (FreLanguage.getInstance().metaConformsToType(modelelement, "ParameterRef")) {
                const attr = (modelelement as ParameterRef).attribute;
                if (notNullOrUndefined(attr)) {
                    result = this.mainTyper.inferType(attr);
                    return result;
                }
            }
        }
        if (FreLanguage.getInstance().metaConformsToType(modelelement, "MultiplyExpression")) {
            const leftType = this.mainTyper.inferType((modelelement as MultiplyExpression).left);
            const rightType = this.mainTyper.inferType((modelelement as MultiplyExpression).right);
            if (notNullOrUndefined(leftType) && notNullOrUndefined(rightType)) {
                // see if we are multiplying a percentage and an EUR
                if ((leftType.toAstElement() === PercentageType.Percentage && rightType.toAstElement() === EuroType.EUR)
                  || (rightType.toAstElement() === PercentageType.Percentage && leftType.toAstElement() === EuroType.EUR)) {
                    return AstType.create({ astElement: EuroType.EUR });
                }
                // see if we are multiplying a percentage and a number
                if ((leftType.toAstElement() === PercentageType.Percentage && rightType.toAstElement() === NumberType.Number)
                  || (rightType.toAstElement() === PercentageType.Percentage && leftType.toAstElement() === NumberType.Number)) {
                    return AstType.create({ astElement: PercentageType.Percentage });
                }
            }
        }
        return undefined;
    }

    equals(type1: FreType, type2: FreType): boolean | undefined {
        return undefined;
    }

    conforms(type1: FreType, type2: FreType): boolean | undefined {
        return undefined;
    }

    conformsList(typelist1: FreType[], typelist2: FreType[]): boolean | undefined {
        return undefined;
    }

    commonSuper(typelist: FreType[]): FreType | undefined {
        return undefined;
    }

    public getSuperTypes(type: FreType): FreType[] | undefined {
        return undefined;
    }
}
